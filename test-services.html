<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Services - Firebase</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .service {
        border: 1px solid #ddd;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }
      .service h3 {
        margin: 0 0 10px 0;
        color: #333;
      }
      .service p {
        margin: 5px 0;
      }
      .price {
        font-weight: bold;
        color: #2563eb;
      }
      .controls {
        margin: 20px 0;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .btn-primary {
        background: #2563eb;
        color: white;
      }
      .btn-success {
        background: #16a34a;
        color: white;
      }
      .btn-danger {
        background: #dc2626;
        color: white;
      }
      #console {
        background: #f3f4f6;
        padding: 15px;
        border-radius: 5px;
        margin-top: 20px;
        max-height: 300px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <h1>Test Services - Firebase Connection</h1>

    <div class="controls">
      <button class="btn-primary" onclick="loadServices()">
        üîÑ Cargar Servicios
      </button>
      <button class="btn-success" onclick="createExampleServices()">
        ‚ûï Crear Servicios de Ejemplo
      </button>
      <button class="btn-danger" onclick="clearServices()">
        üóëÔ∏è Limpiar Servicios
      </button>
    </div>

    <div id="services-container">
      <p>Haz clic en "Cargar Servicios" para ver los servicios de Firebase</p>
    </div>

    <div id="console">
      <h3>Console Log:</h3>
      <div id="console-output"></div>
    </div>

    <!-- Firebase scripts -->
    <script src="js/firebase-init.js"></script>
    <script src="js/firebase.js"></script>

    <script>
      // Console override to capture logs
      const originalLog = console.log;
      const originalError = console.error;

      function logToConsole(message, type = "log") {
        const consoleOutput = document.getElementById("console-output");
        const div = document.createElement("div");
        div.style.color = type === "error" ? "red" : "black";
        div.style.fontSize = "12px";
        div.style.marginBottom = "3px";
        div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        consoleOutput.appendChild(div);
        consoleOutput.scrollTop = consoleOutput.scrollHeight;
      }

      console.log = function (...args) {
        originalLog.apply(console, args);
        logToConsole(args.join(" "));
      };

      console.error = function (...args) {
        originalError.apply(console, args);
        logToConsole(args.join(" "), "error");
      };

      // Wait for Firebase to be ready
      async function waitForFirebase() {
        let attempts = 0;
        while (
          (!window.firebaseManager || !window.firebaseManager.initialized) &&
          attempts < 20
        ) {
          console.log(`‚è≥ Esperando Firebase... (intento ${attempts + 1})`);
          await new Promise((resolve) => setTimeout(resolve, 500));
          attempts++;
        }

        if (window.firebaseManager && window.firebaseManager.initialized) {
          console.log("‚úÖ Firebase est√° listo");
          return true;
        } else {
          console.error("‚ùå Firebase no se pudo inicializar");
          return false;
        }
      }

      async function loadServices() {
        console.log("üîÑ Cargando servicios...");

        if (!(await waitForFirebase())) {
          return;
        }

        try {
          const services = await window.firebaseManager.getServices();
          console.log("üìã Servicios obtenidos:", services);

          const container = document.getElementById("services-container");

          if (services && services.length > 0) {
            container.innerHTML = "<h2>Servicios encontrados:</h2>";
            services.forEach((service) => {
              container.innerHTML += `
                            <div class="service">
                                <h3>${service.name}</h3>
                                <p><strong>Descripci√≥n:</strong> ${
                                  service.description
                                }</p>
                                <p><strong>Duraci√≥n:</strong> ${
                                  service.duration
                                } minutos</p>
                                <p class="price"><strong>Precio:</strong> $${service.price.toLocaleString()}</p>
                                <p><strong>ID:</strong> ${service.id}</p>
                                ${
                                  service.order
                                    ? `<p><strong>Orden:</strong> ${service.order}</p>`
                                    : ""
                                }
                            </div>
                        `;
            });
          } else {
            container.innerHTML = "<h2>‚ùå No se encontraron servicios</h2>";
          }

          console.log(`‚úÖ Se cargaron ${services.length} servicios`);
        } catch (error) {
          console.error("‚ùå Error cargando servicios:", error);
          document.getElementById("services-container").innerHTML =
            "<h2>‚ùå Error cargando servicios</h2>";
        }
      }

      async function createExampleServices() {
        console.log("üîß Creando servicios de ejemplo...");

        if (!(await waitForFirebase())) {
          return;
        }

        const exampleServices = [
          {
            name: "Reiki Usui",
            description:
              "Terapia energ√©tica que promueve la relajaci√≥n profunda y el equilibrio de los chakras.",
            duration: 60,
            price: 12000,
            order: 1,
          },
          {
            name: "Meditaci√≥n Guiada",
            description:
              "Sesiones de meditaci√≥n mindfulness para encontrar paz interior y reducir el estr√©s.",
            duration: 45,
            price: 10000,
            order: 2,
          },
          {
            name: "Masajes Terap√©uticos",
            description:
              "Masajes relajantes y descontracturantes para liberar tensiones corporales.",
            duration: 90,
            price: 14000,
            order: 3,
          },
          {
            name: "Aromaterapia",
            description:
              "Terapia hol√≠stica con aceites esenciales puros para el bienestar integral.",
            duration: 75,
            price: 12000,
            order: 4,
          },
        ];

        try {
          for (const service of exampleServices) {
            const serviceId = await window.firebaseManager.saveService(service);
            console.log(
              `‚úÖ Servicio creado: ${service.name} (ID: ${serviceId})`
            );
          }

          console.log("üéâ Todos los servicios de ejemplo creados");

          // Recargar servicios
          setTimeout(() => loadServices(), 1000);
        } catch (error) {
          console.error("‚ùå Error creando servicios:", error);
        }
      }

      async function clearServices() {
        console.log("üóëÔ∏è Limpiando servicios...");

        if (!(await waitForFirebase())) {
          return;
        }

        try {
          const services = await window.firebaseManager.getServices();

          for (const service of services) {
            await window.firebaseManager.deleteService(service.id);
            console.log(`üóëÔ∏è Servicio eliminado: ${service.name}`);
          }

          console.log("‚úÖ Todos los servicios eliminados");

          // Recargar servicios
          setTimeout(() => loadServices(), 1000);
        } catch (error) {
          console.error("‚ùå Error eliminando servicios:", error);
        }
      }

      // Auto-load services when page loads
      window.addEventListener("load", () => {
        setTimeout(() => {
          console.log("üöÄ P√°gina cargada, intentando cargar servicios...");
          loadServices();
        }, 2000);
      });
    </script>
  </body>
</html>
