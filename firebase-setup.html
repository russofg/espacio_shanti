<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Configuración de Firebase - Espacio Shanti</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
      <div class="bg-white rounded-lg shadow-lg p-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">
          <i class="fas fa-fire text-orange-500 mr-3"></i>
          Configuración de Firebase
        </h1>

        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-8">
          <h2 class="text-lg font-semibold text-red-800 mb-2">
            <i class="fas fa-exclamation-triangle mr-2"></i>
            Error de Permisos Detectado
          </h2>
          <p class="text-red-700">
            <strong>Error:</strong> Missing or insufficient permissions.<br />
            <strong>Causa:</strong> Las reglas de Firestore no permiten el
            acceso a la colección de blog.
          </p>
        </div>

        <div class="space-y-8">
          <!-- Paso 1: Configurar Firebase CLI -->
          <div class="border border-gray-200 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
              <span
                class="bg-blue-500 text-white rounded-full w-8 h-8 inline-flex items-center justify-center mr-3"
                >1</span
              >
              Instalar Firebase CLI
            </h3>
            <div class="bg-gray-900 text-green-400 p-4 rounded-lg mb-4">
              <code>npm install -g firebase-tools</code>
            </div>
            <p class="text-gray-600">
              Instala las herramientas de línea de comandos de Firebase
              globalmente.
            </p>
          </div>

          <!-- Paso 2: Login Firebase -->
          <div class="border border-gray-200 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
              <span
                class="bg-blue-500 text-white rounded-full w-8 h-8 inline-flex items-center justify-center mr-3"
                >2</span
              >
              Iniciar Sesión en Firebase
            </h3>
            <div class="bg-gray-900 text-green-400 p-4 rounded-lg mb-4">
              <code>firebase login</code>
            </div>
            <p class="text-gray-600">
              Autentícate con tu cuenta de Google que tiene acceso al proyecto
              Firebase.
            </p>
          </div>

          <!-- Paso 3: Inicializar Proyecto -->
          <div class="border border-gray-200 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
              <span
                class="bg-blue-500 text-white rounded-full w-8 h-8 inline-flex items-center justify-center mr-3"
                >3</span
              >
              Inicializar Proyecto (si no está hecho)
            </h3>
            <div class="bg-gray-900 text-green-400 p-4 rounded-lg mb-4">
              <code>firebase init firestore</code>
            </div>
            <p class="text-gray-600">
              Configura Firestore en tu proyecto. Selecciona el proyecto
              existente cuando se te pida.
            </p>
          </div>

          <!-- Paso 4: Desplegar Reglas -->
          <div class="border border-gray-200 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
              <span
                class="bg-green-500 text-white rounded-full w-8 h-8 inline-flex items-center justify-center mr-3"
                >4</span
              >
              Desplegar Reglas de Firestore
            </h3>
            <div class="bg-gray-900 text-green-400 p-4 rounded-lg mb-4">
              <code>firebase deploy --only firestore:rules</code>
            </div>
            <p class="text-gray-600 mb-4">O usa el script que hemos creado:</p>
            <div class="bg-gray-900 text-green-400 p-4 rounded-lg mb-4">
              <code>./deploy-firestore-rules.sh</code>
            </div>
            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
              <p class="text-green-800">
                <i class="fas fa-info-circle mr-2"></i>
                <strong>Reglas incluidas:</strong> Permitir lectura pública del
                blog y escritura solo a terapeutas autenticadas.
              </p>
            </div>
          </div>

          <!-- Paso 5: Crear Cuentas de Terapeutas -->
          <div class="border border-gray-200 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
              <span
                class="bg-purple-500 text-white rounded-full w-8 h-8 inline-flex items-center justify-center mr-3"
                >5</span
              >
              Crear Cuentas de Terapeutas
            </h3>
            <p class="text-gray-600 mb-4">
              Usa la herramienta que hemos creado:
            </p>
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
              <p class="text-blue-800">
                <i class="fas fa-link mr-2"></i>
                <a
                  href="setup-therapist-accounts.html"
                  class="text-blue-600 hover:text-blue-800 underline"
                >
                  Abrir Setup de Cuentas de Terapeutas
                </a>
              </p>
            </div>
          </div>

          <!-- Verificación -->
          <div
            class="border border-gray-200 rounded-lg p-6 bg-gradient-to-r from-green-50 to-blue-50"
          >
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
              <i class="fas fa-check-circle text-green-500 mr-3"></i>
              Verificación
            </h3>
            <div class="space-y-3">
              <label class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  class="form-checkbox h-5 w-5 text-green-600"
                />
                <span class="text-gray-700">Firebase CLI instalado</span>
              </label>
              <label class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  class="form-checkbox h-5 w-5 text-green-600"
                />
                <span class="text-gray-700">Sesión iniciada en Firebase</span>
              </label>
              <label class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  class="form-checkbox h-5 w-5 text-green-600"
                />
                <span class="text-gray-700"
                  >Reglas de Firestore desplegadas</span
                >
              </label>
              <label class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  class="form-checkbox h-5 w-5 text-green-600"
                />
                <span class="text-gray-700">Cuentas de terapeutas creadas</span>
              </label>
            </div>
          </div>

          <!-- Archivo de Reglas -->
          <div class="border border-gray-200 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
              <i class="fas fa-file-code text-orange-500 mr-3"></i>
              Contenido de firestore.rules
            </h3>
            <pre
              class="bg-gray-900 text-gray-300 p-4 rounded-lg overflow-x-auto text-sm"
            ><code>rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Reglas para la colección de entradas del blog
    match /blogEntries/{document} {
      // Permitir lectura a todos (para mostrar los artículos públicamente)
      allow read: if true;
      
      // Permitir escritura solo a usuarios autenticados (terapeutas)
      allow write: if request.auth != null 
        && request.auth.token.email_verified == true
        && (request.auth.token.email == 'lorena@espacioshanti.com' 
            || request.auth.token.email == 'betsabe@espacioshanti.com');
    }
  }
}</code></pre>
          </div>
        </div>

        <div class="text-center mt-8">
          <a
            href="index.html"
            class="inline-flex items-center px-6 py-3 bg-sage-600 text-white rounded-lg hover:bg-sage-700 transition-colors"
          >
            <i class="fas fa-arrow-left mr-2"></i>
            Volver al Sitio Principal
          </a>
        </div>
      </div>
    </div>

    <style>
      .form-checkbox:checked {
        background-color: #10b981;
        border-color: #10b981;
      }
    </style>
  </body>
</html>
