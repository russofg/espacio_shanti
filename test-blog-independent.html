<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Blog Independiente - Espacio Shanti</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body class="bg-gray-100">
    <div class="container mx-auto p-8">
      <h1 class="text-3xl font-bold mb-6 text-center">
        üß™ Test Blog Independiente
      </h1>

      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">Control de Datos</h2>
        <div class="space-y-4">
          <button
            onclick="clearAndCreateTest()"
            class="w-full bg-red-500 text-white px-6 py-3 rounded hover:bg-red-600"
          >
            üóëÔ∏è Limpiar TODO y Crear Entrada de Prueba
          </button>

          <button
            onclick="viewCurrentData()"
            class="w-full bg-blue-500 text-white px-6 py-3 rounded hover:bg-blue-600"
          >
            üëÄ Ver Datos Actuales
          </button>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">Vista Previa del Blog</h2>
        <div id="blog-preview" class="space-y-4">
          <!-- Las tarjetas aparecer√°n aqu√≠ -->
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold mb-4">Debug Log</h2>
        <div
          id="debug-log"
          class="bg-gray-100 p-4 rounded min-h-[200px] font-mono text-sm"
        >
          <p class="text-gray-600">Los logs aparecer√°n aqu√≠...</p>
        </div>
      </div>
    </div>

    <script>
      // Funci√≥n de logging independiente
      function debugLog(message, type = "info") {
        const logContainer = document.getElementById("debug-log");
        const timestamp = new Date().toLocaleTimeString();
        const colors = {
          info: "text-blue-600",
          success: "text-green-600",
          error: "text-red-600",
          warning: "text-yellow-600",
        };

        const logEntry = document.createElement("div");
        logEntry.className = colors[type] || "text-gray-600";
        logEntry.innerHTML = `[${timestamp}] ${message}`;

        logContainer.appendChild(logEntry);
        logContainer.scrollTop = logContainer.scrollHeight;
      }

      function clearAndCreateTest() {
        // Limpiar log
        document.getElementById("debug-log").innerHTML = "";

        debugLog("üóëÔ∏è Limpiando datos existentes...", "warning");

        // Limpiar localStorage
        localStorage.removeItem("blogEntries");

        debugLog("‚úÖ localStorage limpio", "success");

        // Crear entrada de prueba con formato PERFECTO
        const now = new Date();
        const testEntry = {
          id: "test-perfect-" + Date.now(),
          title: "Entrada de Prueba Perfecta",
          content:
            "Esta es una entrada creada espec√≠ficamente para probar que las fechas, emojis y autores se muestren correctamente. Tiene m√°s de 200 caracteres para cumplir con todas las validaciones del sistema. Deber√≠a mostrar la fecha actual, un emoji v√°lido y el nombre del autor extra√≠do del email.",
          summary:
            "Entrada de prueba con formato perfecto para verificar fechas, emojis y autores.",
          author: "maria.garcia@espacioshanti.com",
          createdAt: now.toISOString(),
          date: now.toLocaleDateString("es-ES", {
            year: "numeric",
            month: "long",
            day: "numeric",
          }),
          category: "terapias",
          emoji: "üíÜ‚Äç‚ôÄÔ∏è",
          tips: ["Tip de prueba 1", "Tip de prueba 2"],
        };

        debugLog("‚ú® Creando entrada de prueba...", "info");
        debugLog(`üìù T√≠tulo: "${testEntry.title}"`, "info");
        debugLog(`üìÖ createdAt: ${testEntry.createdAt}`, "info");
        debugLog(`üìÖ date: ${testEntry.date}`, "info");
        debugLog(`üòÄ emoji: ${testEntry.emoji}`, "info");
        debugLog(`üë§ author: ${testEntry.author}`, "info");
        debugLog(`üè∑Ô∏è category: ${testEntry.category}`, "info");

        // Guardar en localStorage
        localStorage.setItem("blogEntries", JSON.stringify([testEntry]));

        debugLog("üíæ Entrada guardada en localStorage", "success");

        // Generar vista previa
        generateBlogPreview();
      }

      function viewCurrentData() {
        document.getElementById("debug-log").innerHTML = "";

        debugLog("üëÄ Verificando datos actuales...", "info");

        try {
          const entries = JSON.parse(
            localStorage.getItem("blogEntries") || "[]"
          );

          if (entries.length === 0) {
            debugLog("‚ùå No hay entradas en localStorage", "error");
          } else {
            debugLog(`üìä Encontradas ${entries.length} entradas`, "success");

            entries.forEach((entry, index) => {
              debugLog(`\nüìÑ Entrada ${index + 1}:`, "info");
              debugLog(`  ‚Ä¢ ID: ${entry.id}`, "info");
              debugLog(`  ‚Ä¢ T√≠tulo: "${entry.title}"`, "info");
              debugLog(
                `  ‚Ä¢ createdAt: ${entry.createdAt || "NO DEFINIDO"}`,
                entry.createdAt ? "success" : "error"
              );
              debugLog(
                `  ‚Ä¢ date: ${entry.date || "NO DEFINIDO"}`,
                entry.date ? "success" : "error"
              );
              debugLog(
                `  ‚Ä¢ emoji: "${entry.emoji || "NO DEFINIDO"}"`,
                entry.emoji && entry.emoji !== "undefined" ? "success" : "error"
              );
              debugLog(
                `  ‚Ä¢ author: ${entry.author || "NO DEFINIDO"}`,
                entry.author ? "success" : "error"
              );
            });
          }

          // Generar vista previa
          generateBlogPreview();
        } catch (error) {
          debugLog(`‚ùå Error al leer datos: ${error.message}`, "error");
        }
      }

      function generateBlogPreview() {
        debugLog("\nüé® Generando vista previa del blog...", "info");

        const blogContainer = document.getElementById("blog-preview");

        try {
          const entries = JSON.parse(
            localStorage.getItem("blogEntries") || "[]"
          );

          if (entries.length === 0) {
            blogContainer.innerHTML =
              '<p class="text-gray-500 italic">No hay entradas para mostrar</p>';
            return;
          }

          debugLog(`üìä Procesando ${entries.length} entradas...`, "info");

          blogContainer.innerHTML = entries
            .map((entry, index) => {
              debugLog(
                `\nüîÑ Procesando entrada ${index + 1}: "${entry.title}"`,
                "info"
              );

              // Validar y formatear fecha - EXACTAMENTE como en app.js
              let formattedDate = "Fecha no disponible";
              const dateValue = entry.createdAt || entry.date;

              if (dateValue && typeof dateValue === "string") {
                try {
                  // Si ya es una fecha formateada en espa√±ol
                  if (dateValue.includes("de") && dateValue.includes("de")) {
                    formattedDate = dateValue;
                    debugLog(
                      `  ‚úÖ Fecha en espa√±ol: ${formattedDate}`,
                      "success"
                    );
                  } else {
                    // Intentar parsear como Date
                    const date = new Date(dateValue);
                    if (!isNaN(date.getTime())) {
                      formattedDate = date.toLocaleDateString("es-ES", {
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                      });
                      debugLog(
                        `  ‚úÖ Fecha parseada: ${formattedDate}`,
                        "success"
                      );
                    } else {
                      debugLog(`  ‚ùå Fecha inv√°lida: ${dateValue}`, "error");
                    }
                  }
                } catch (e) {
                  debugLog(
                    `  ‚ùå Error al formatear fecha: ${e.message}`,
                    "error"
                  );
                }
              } else {
                debugLog(`  ‚ùå Sin fecha v√°lida: ${dateValue}`, "error");
              }

              // Validar emoji
              let emoji = "üìù";
              if (
                entry.emoji &&
                typeof entry.emoji === "string" &&
                entry.emoji.trim() !== "" &&
                entry.emoji !== "undefined" &&
                entry.emoji.toLowerCase() !== "undefined"
              ) {
                emoji = entry.emoji;
                debugLog(`  ‚úÖ Emoji v√°lido: ${emoji}`, "success");
              } else {
                debugLog(
                  `  ‚ùå Emoji inv√°lido: "${entry.emoji}", usando fallback: ${emoji}`,
                  "warning"
                );
              }

              // Validar categor√≠a
              let category = "general";
              if (
                entry.category &&
                typeof entry.category === "string" &&
                entry.category.trim() !== "" &&
                entry.category !== "undefined"
              ) {
                category = entry.category;
                debugLog(`  ‚úÖ Categor√≠a v√°lida: ${category}`, "success");
              } else {
                debugLog(
                  `  ‚ùå Categor√≠a inv√°lida: "${entry.category}", usando: ${category}`,
                  "warning"
                );
              }
              const categoryDisplay =
                category.charAt(0).toUpperCase() + category.slice(1);

              // Validar y procesar autor
              let authorName = "Equipo Espacio Shanti";
              if (
                entry.author &&
                typeof entry.author === "string" &&
                entry.author.trim() !== "" &&
                entry.author !== "undefined"
              ) {
                if (entry.author.includes("@")) {
                  const emailPart = entry.author.split("@")[0];
                  if (emailPart && emailPart.length > 0) {
                    authorName = emailPart.replace(/[._]/g, " ");
                    authorName = authorName
                      .split(" ")
                      .map((word) =>
                        word && word.length > 0
                          ? word.charAt(0).toUpperCase() + word.slice(1)
                          : word
                      )
                      .join(" ");
                    debugLog(
                      `  ‚úÖ Autor extra√≠do de email: ${authorName}`,
                      "success"
                    );
                  }
                } else {
                  authorName = entry.author;
                  debugLog(`  ‚úÖ Autor directo: ${authorName}`, "success");
                }
              } else {
                debugLog(
                  `  ‚ùå Autor inv√°lido: "${entry.author}", usando fallback: ${authorName}`,
                  "warning"
                );
              }

              // Validar t√≠tulo
              const title =
                entry.title &&
                typeof entry.title === "string" &&
                entry.title.trim() !== "" &&
                entry.title !== "undefined"
                  ? entry.title
                  : "Sin t√≠tulo";

              if (title === "Sin t√≠tulo") {
                debugLog(`  ‚ùå T√≠tulo inv√°lido: "${entry.title}"`, "error");
              } else {
                debugLog(`  ‚úÖ T√≠tulo v√°lido: ${title}`, "success");
              }

              // Validar contenido
              const content =
                entry.content && typeof entry.content === "string"
                  ? entry.content
                  : "";
              const previewContent =
                content.length > 120
                  ? content.substring(0, 120) + "..."
                  : content;

              return `
                        <article class="bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden">
                            <div class="p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-green-100 to-emerald-100 text-green-700">
                                        <span class="mr-1">${emoji}</span>
                                        ${categoryDisplay}
                                    </span>
                                    <time class="text-sm text-gray-500" datetime="${
                                      entry.createdAt || entry.date || ""
                                    }">
                                        ${formattedDate}
                                    </time>
                                </div>

                                <h3 class="text-xl font-bold text-gray-800 mb-3">
                                    ${title}
                                </h3>

                                <p class="text-gray-600 mb-4 leading-relaxed">
                                    ${
                                      previewContent ||
                                      "Sin contenido disponible"
                                    }
                                </p>

                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-emerald-400 rounded-full flex items-center justify-center">
                                            <i class="fas fa-user text-white text-xs"></i>
                                        </div>
                                        <span class="text-sm text-gray-700 font-medium">
                                            ${authorName}
                                        </span>
                                    </div>
                                    
                                    <button class="inline-flex items-center text-green-600 hover:text-green-700 font-medium text-sm transition-colors">
                                        Leer m√°s
                                        <i class="fas fa-arrow-right ml-1 text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </article>
                    `;
            })
            .join("");

          debugLog("\nüéâ Vista previa generada correctamente", "success");
        } catch (error) {
          debugLog(
            `‚ùå Error al generar vista previa: ${error.message}`,
            "error"
          );
          blogContainer.innerHTML = `<p class="text-red-500">Error: ${error.message}</p>`;
        }
      }

      // Cargar al inicio
      document.addEventListener("DOMContentLoaded", function () {
        debugLog("üöÄ Test blog independiente cargado", "success");
        debugLog(
          'üí° Usa "Limpiar TODO y Crear Entrada de Prueba" para empezar',
          "info"
        );
      });
    </script>
  </body>
</html>
