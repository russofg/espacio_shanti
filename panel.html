<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de Terapeutas - Espacio Shanti</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <!-- Iconos -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css" />

    <!-- Tailwind Config Custom -->
    <script src="js/tailwind-config.js"></script>
  </head>
  <body
    class="bg-gradient-to-br from-sage-100 via-warm-white to-lavender-light min-h-screen"
  >
    <!-- Decorative background elements -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
      <div
        class="absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-sage-200/30 to-sage-300/20 rounded-full blur-3xl"
      ></div>
      <div
        class="absolute -bottom-40 -left-40 w-80 h-80 bg-gradient-to-tr from-lavender-light/40 to-earth-light/20 rounded-full blur-3xl"
      ></div>
      <div
        class="absolute top-1/4 left-1/4 w-32 h-32 bg-premium-gold-light/20 rounded-full blur-2xl animate-pulse-soft"
      ></div>
    </div>
    <!-- Login Modal -->
    <div
      id="login-section"
      class="fixed inset-0 bg-black/20 backdrop-blur-sm flex items-center justify-center z-50"
    >
      <div
        class="bg-white/95 backdrop-blur-md rounded-2xl shadow-floating p-8 max-w-md w-full mx-4 border border-white/20 animate-scale-in"
      >
        <div class="text-center mb-8">
          <div
            class="w-16 h-16 bg-gradient-to-br from-sage-400 to-sage-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-elegant"
          >
            <i class="fas fa-spa text-white text-2xl"></i>
          </div>
          <h2 class="text-2xl font-serif font-semibold text-gray-800 mb-2">
            Acceso de Terapeutas
          </h2>
          <p class="text-gray-600">
            Ingresa tus credenciales para acceder al panel profesional
          </p>
        </div>

        <form id="login-form" class="space-y-6">
          <div
            id="login-error"
            class="hidden bg-red-100 border border-red-300 text-red-700 px-4 py-3 rounded-lg text-sm"
          ></div>

          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">
              <i class="fas fa-envelope text-sage-500 mr-2"></i>Email
            </label>
            <input
              type="email"
              id="therapist-email"
              required
              class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sage-400 focus:border-transparent transition-all duration-200 bg-white/80 backdrop-blur-sm"
              placeholder="tu@espacioshanti.com"
            />
          </div>

          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">
              <i class="fas fa-lock text-sage-500 mr-2"></i>Contraseña
            </label>
            <input
              type="password"
              id="therapist-password"
              required
              class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-sage-400 focus:border-transparent transition-all duration-200 bg-white/80 backdrop-blur-sm"
              placeholder="••••••••"
            />
          </div>

          <button
            type="submit"
            class="w-full bg-gradient-to-r from-sage-500 to-sage-600 hover:from-sage-600 hover:to-sage-700 text-white py-4 px-6 rounded-xl font-medium shadow-elegant hover:shadow-premium transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98]"
          >
            <i class="fas fa-sign-in-alt mr-2"></i>
            Iniciar Sesión
          </button>
        </form>

        <div class="mt-6 text-center">
          <p class="text-sm text-gray-600">
            ¿Problemas para acceder?
            <a
              href="mailto:admin@espacioshanti.com"
              class="text-sage-600 hover:text-sage-700 font-medium transition-colors"
              >Contacta al administrador</a
            >
          </p>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main
      id="main-content"
      class="hidden max-w-7xl mx-auto px-2 sm:px-4 lg:px-8 py-4 sm:py-8 relative z-10"
    >
      <!-- Premium Header -->
      <div class="mb-8 animate-fade-in">
        <div
          class="bg-white/90 backdrop-blur-md rounded-2xl shadow-floating border border-white/20 p-6 relative overflow-hidden"
        >
          <!-- Decorative elements -->
          <div
            class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-sage-200/30 to-transparent rounded-full -mr-16 -mt-16"
          ></div>
          <div
            class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-premium-gold-light/30 to-transparent rounded-full -ml-12 -mb-12"
          ></div>

          <div class="flex justify-between items-center relative z-10">
            <div class="flex items-center space-x-4">
              <div
                class="w-12 h-12 bg-gradient-to-br from-sage-400 to-sage-600 rounded-xl flex items-center justify-center shadow-elegant"
              >
                <i class="fas fa-spa text-white text-xl"></i>
              </div>
              <div>
                <h1 class="text-2xl font-serif font-semibold text-gray-800">
                  Espacio Shanti
                </h1>
                <p class="text-sage-600 font-medium">Panel Profesional</p>
              </div>
            </div>

            <div class="flex items-center space-x-4">
              <div id="auth-status" class="text-right">
                <div class="flex items-center space-x-2 text-gray-500">
                  <i class="fas fa-user-times"></i>
                  <span>No autenticada</span>
                </div>
              </div>
              <button
                id="logout-btn-mobile"
                class="bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 text-gray-700 p-3 rounded-xl shadow-soft hover:shadow-elegant transition-all duration-200 transform hover:scale-105"
                title="Cerrar Sesión"
              >
                <i class="fas fa-sign-out-alt text-lg"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Premium Dashboard Stats -->
      <div
        class="grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-6 mb-8 animate-slide-up"
      >
        <!-- Reservas Hoy -->
        <div
          class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-elegant hover:shadow-premium transition-all duration-300 p-6 border border-white/20 group hover:scale-[1.02] transform"
        >
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-4">
              <div
                class="w-14 h-14 bg-gradient-to-br from-sage-400 to-sage-600 rounded-2xl flex items-center justify-center shadow-elegant group-hover:shadow-premium transition-all duration-300"
              >
                <i class="fas fa-calendar-check text-white text-xl"></i>
              </div>
              <div>
                <p class="text-sm font-medium text-gray-600">Reservas Hoy</p>
                <p
                  id="today-reservations"
                  class="text-3xl font-bold text-gray-800"
                >
                  0
                </p>
              </div>
            </div>
            <div
              class="w-12 h-12 bg-sage-100 rounded-full flex items-center justify-center"
            >
              <i class="fas fa-arrow-up text-sage-600 text-sm"></i>
            </div>
          </div>
          <div class="bg-sage-50 rounded-lg p-3">
            <div class="flex items-center justify-between">
              <span class="text-sm text-sage-700">Estado del día</span>
              <span
                class="text-xs bg-sage-200 text-sage-800 px-2 py-1 rounded-full"
                >Activo</span
              >
            </div>
          </div>
        </div>

        <!-- Próxima Cita -->
        <div
          class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-elegant hover:shadow-premium transition-all duration-300 p-6 border border-white/20 group hover:scale-[1.02] transform"
        >
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-4">
              <div
                class="w-14 h-14 bg-gradient-to-br from-premium-gold to-premium-gold-dark rounded-2xl flex items-center justify-center shadow-elegant group-hover:shadow-premium transition-all duration-300"
              >
                <i class="fas fa-clock text-white text-xl"></i>
              </div>
              <div>
                <p class="text-sm font-medium text-gray-600">Próxima Cita</p>
                <p
                  id="next-appointment"
                  class="text-lg font-bold text-gray-800 leading-tight"
                >
                  Sin citas
                </p>
              </div>
            </div>
            <div
              class="w-12 h-12 bg-premium-gold-light rounded-full flex items-center justify-center"
            >
              <i class="fas fa-star text-premium-gold-dark text-sm"></i>
            </div>
          </div>
          <div class="bg-premium-gold-light/30 rounded-lg p-3">
            <div class="flex items-center justify-between">
              <span class="text-sm text-premium-gold-dark">Recordatorio</span>
              <span
                class="text-xs bg-premium-gold-light text-premium-gold-dark px-2 py-1 rounded-full"
                >30 min antes</span
              >
            </div>
          </div>
        </div>

        <!-- Esta Semana -->
        <div
          class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-elegant hover:shadow-premium transition-all duration-300 p-6 border border-white/20 group hover:scale-[1.02] transform"
        >
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-4">
              <div
                class="w-14 h-14 bg-gradient-to-br from-lavender-dark to-purple-500 rounded-2xl flex items-center justify-center shadow-elegant group-hover:shadow-premium transition-all duration-300"
              >
                <i class="fas fa-chart-line text-white text-xl"></i>
              </div>
              <div>
                <p class="text-sm font-medium text-gray-600">Esta Semana</p>
                <p
                  id="week-reservations"
                  class="text-3xl font-bold text-gray-800"
                >
                  0
                </p>
              </div>
            </div>
            <div
              class="w-12 h-12 bg-lavender-light rounded-full flex items-center justify-center"
            >
              <i class="fas fa-trending-up text-purple-600 text-sm"></i>
            </div>
          </div>
          <div class="bg-lavender-light/50 rounded-lg p-3">
            <div class="flex items-center justify-between">
              <span class="text-sm text-purple-700">Progreso semanal</span>
              <span
                class="text-xs bg-lavender-light text-purple-700 px-2 py-1 rounded-full"
                >En curso</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Calendar and Reservations -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8">
        <!-- Premium Weekly Calendar -->
        <div class="lg:col-span-2 order-2 lg:order-1 animate-fade-in">
          <div
            class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-floating border border-white/20 p-6 relative overflow-hidden"
          >
            <!-- Decorative header gradient -->
            <div
              class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-sage-400 via-premium-gold to-lavender-dark"
            ></div>

            <div class="flex justify-between items-center mb-6">
              <div class="flex items-center space-x-3">
                <div
                  class="w-10 h-10 bg-gradient-to-br from-sage-400 to-sage-600 rounded-lg flex items-center justify-center shadow-elegant"
                >
                  <i class="fas fa-calendar-alt text-white"></i>
                </div>
                <div>
                  <h3 class="text-xl font-semibold text-gray-800">
                    Calendario Semanal
                  </h3>
                  <p class="text-sm text-gray-600">
                    Gestiona tus citas profesionales
                  </p>
                </div>
              </div>
              <div class="flex items-center space-x-2">
                <button
                  id="prev-week"
                  class="p-2 rounded-lg hover:bg-sage-100 transition-all duration-200 text-sage-600 hover:text-sage-700 hover:shadow-soft"
                >
                  <i class="fas fa-chevron-left"></i>
                </button>
                <span
                  id="current-week"
                  class="px-4 py-2 text-sm font-medium text-gray-700 bg-sage-100 rounded-lg"
                ></span>
                <button
                  id="next-week"
                  class="p-2 rounded-lg hover:bg-sage-100 transition-all duration-200 text-sage-600 hover:text-sage-700 hover:shadow-soft"
                >
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>

            <div
              id="weekly-calendar"
              class="overflow-x-auto bg-white/50 rounded-xl p-4 shadow-inner-soft"
            >
              <!-- Calendar will be generated here -->
            </div>
          </div>
        </div>

        <!-- Premium Right Panel -->
        <div class="lg:col-span-1 order-1 lg:order-2 space-y-6">
          <!-- Today's Reservations -->
          <div
            class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-floating border border-white/20 p-6 animate-slide-up"
          >
            <div class="flex items-center space-x-3 mb-6">
              <div
                class="w-10 h-10 bg-gradient-to-br from-premium-gold to-premium-gold-dark rounded-lg flex items-center justify-center shadow-elegant"
              >
                <i class="fas fa-today text-white"></i>
              </div>
              <div>
                <h3 class="text-xl font-semibold text-gray-800">
                  Reservas de Hoy
                </h3>
                <p class="text-sm text-gray-600">Citas programadas para hoy</p>
              </div>
            </div>
            <div id="today-reservations-list" class="space-y-3">
              <!-- Today's reservations will be listed here -->
            </div>
          </div>

          <!-- Sistema de Recordatorios -->
          <div
            class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-floating border border-white/20 p-6 animate-slide-up"
          >
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center space-x-3">
                <div
                  class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-elegant"
                >
                  <i class="fas fa-bell text-white"></i>
                </div>
                <div>
                  <h3 class="text-xl font-semibold text-gray-800">
                    Recordatorios Automáticos
                  </h3>
                  <p class="text-sm text-gray-600">Sistema de notificaciones</p>
                </div>
              </div>
              <div class="flex items-center space-x-2">
                <div id="reminder-status" class="flex items-center space-x-2">
                  <div
                    class="w-2 h-2 bg-green-500 rounded-full animate-pulse"
                  ></div>
                  <span class="text-xs text-gray-600">Activo</span>
                </div>
              </div>
            </div>

            <!-- Estadísticas de Recordatorios -->
            <div class="grid grid-cols-2 gap-4 mb-6">
              <div
                class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200"
              >
                <div class="flex items-center space-x-3">
                  <div
                    class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center"
                  >
                    <i class="fas fa-check text-white text-sm"></i>
                  </div>
                  <div>
                    <div class="text-sm text-gray-600">Enviados (7 días)</div>
                    <div
                      id="reminders-sent-count"
                      class="text-lg font-bold text-green-700"
                    >
                      0
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200"
              >
                <div class="flex items-center space-x-3">
                  <div
                    class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center"
                  >
                    <i class="fas fa-clock text-white text-sm"></i>
                  </div>
                  <div>
                    <div class="text-sm text-gray-600">Programados</div>
                    <div
                      id="reminders-pending-count"
                      class="text-lg font-bold text-blue-700"
                    >
                      0
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Próximos Recordatorios -->
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <h4 class="text-sm font-medium text-gray-700">
                  Próximos Recordatorios
                </h4>
                <div class="flex items-center space-x-2">
                  <button
                    onclick="window.refreshReminderStats()"
                    class="text-xs text-sage-600 hover:text-sage-700 transition-colors"
                  >
                    <i class="fas fa-sync-alt mr-1"></i>Actualizar
                  </button>
                </div>
              </div>
              <div
                id="upcoming-reminders"
                class="space-y-2 max-h-32 overflow-y-auto"
              >
                <!-- Próximos recordatorios se mostrarán aquí -->
              </div>
            </div>

            <!-- Controles del Sistema -->
            <div class="mt-6 pt-4 border-t border-gray-200">
              <div class="flex items-center justify-between mb-3">
                <span class="text-sm text-gray-600">Estado del Sistema</span>
                <div class="flex items-center space-x-2">
                  <button
                    onclick="window.diagnoseEmailJS()"
                    class="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs hover:bg-blue-200 transition-colors"
                  >
                    <i class="fas fa-diagnoses mr-1"></i>Diagnóstico
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Premium Quick Actions -->
          <div
            class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-floating border border-white/20 p-6 animate-scale-in"
          >
            <div class="flex items-center space-x-3 mb-6">
              <div
                class="w-10 h-10 bg-gradient-to-br from-lavender-dark to-purple-600 rounded-lg flex items-center justify-center shadow-elegant"
              >
                <i class="fas fa-bolt text-white"></i>
              </div>
              <div>
                <h3 class="text-xl font-semibold text-gray-800">
                  Acciones Rápidas
                </h3>
                <p class="text-sm text-gray-600">Herramientas profesionales</p>
              </div>
            </div>
            <div class="space-y-3">
              <button
                onclick="window.therapistPanel.showNewReservationModal()"
                class="w-full group bg-gradient-to-r from-sage-50 to-sage-100 hover:from-sage-100 hover:to-sage-200 border border-sage-200 rounded-xl p-4 text-left transition-all duration-200 hover:shadow-elegant transform hover:scale-[1.02]"
              >
                <div class="flex items-center space-x-3">
                  <div
                    class="w-8 h-8 bg-sage-500 rounded-lg flex items-center justify-center group-hover:bg-sage-600 transition-colors"
                  >
                    <i class="fas fa-plus text-white text-sm"></i>
                  </div>
                  <div>
                    <div class="font-medium text-gray-800">Nueva Reserva</div>
                    <div class="text-sm text-gray-600">Crear cita manual</div>
                  </div>
                </div>
              </button>
              <button
                onclick="window.therapistPanel.showFullCalendarModal()"
                class="w-full group bg-gradient-to-r from-premium-gold-light/20 to-premium-gold-light/30 hover:from-premium-gold-light/30 hover:to-premium-gold-light/40 border border-premium-gold-light rounded-xl p-4 text-left transition-all duration-200 hover:shadow-elegant transform hover:scale-[1.02]"
              >
                <div class="flex items-center space-x-3">
                  <div
                    class="w-8 h-8 bg-premium-gold rounded-lg flex items-center justify-center group-hover:bg-premium-gold-dark transition-colors"
                  >
                    <i class="fas fa-calendar-alt text-white text-sm"></i>
                  </div>
                  <div>
                    <div class="font-medium text-gray-800">
                      Calendario Completo
                    </div>
                    <div class="text-sm text-gray-600">Vista mensual</div>
                  </div>
                </div>
              </button>
              <button
                onclick="window.therapistPanel.showMonthlyReportsModal()"
                class="w-full group bg-gradient-to-r from-lavender-light/40 to-lavender-light/50 hover:from-lavender-light/50 hover:to-lavender-light/60 border border-lavender-light rounded-xl p-4 text-left transition-all duration-200 hover:shadow-elegant transform hover:scale-[1.02]"
              >
                <div class="flex items-center space-x-3">
                  <div
                    class="w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center group-hover:bg-purple-600 transition-colors"
                  >
                    <i class="fas fa-chart-bar text-white text-sm"></i>
                  </div>
                  <div>
                    <div class="font-medium text-gray-800">Reportes</div>
                    <div class="text-sm text-gray-600">
                      Estadísticas mensuales
                    </div>
                  </div>
                </div>
              </button>

              <button
                onclick="window.therapistPanel.showReminderSystemModal()"
                class="w-full group bg-gradient-to-r from-accent-coral-light/40 to-accent-coral-light/50 hover:from-accent-coral-light/50 hover:to-accent-coral-light/60 border border-accent-coral-light rounded-xl p-4 text-left transition-all duration-200 hover:shadow-elegant transform hover:scale-[1.02]"
              >
                <div class="flex items-center space-x-3">
                  <div
                    class="w-8 h-8 bg-accent-coral rounded-lg flex items-center justify-center group-hover:bg-red-500 transition-colors"
                  >
                    <i class="fas fa-bell text-white text-sm"></i>
                  </div>
                  <div>
                    <div class="font-medium text-gray-800">Recordatorios</div>
                    <div class="text-sm text-gray-600">Sistema automático</div>
                  </div>
                </div>
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      // Funciones para la interfaz de recordatorios
      window.refreshReminderStats = function () {
        console.log("🔄 ACTUALIZAR DATOS - Iniciando...");

        if (window.reminderSystem) {
          const stats = window.reminderSystem.getReminderStats();
          const activeReminders = window.reminderSystem.getActiveReminders();

          // Actualizar contadores
          const sentCount = stats.last7Days || 0;
          const pendingCount = activeReminders.length || 0;

          const sentCountElement = document.getElementById(
            "reminders-sent-count"
          );
          const pendingCountElement = document.getElementById(
            "reminders-pending-count"
          );

          if (sentCountElement) {
            sentCountElement.textContent = sentCount;
          }
          if (pendingCountElement) {
            pendingCountElement.textContent = pendingCount;
          }

          // Mostrar próximos recordatorios
          const upcomingContainer =
            document.getElementById("upcoming-reminders");
          if (upcomingContainer) {
            upcomingContainer.innerHTML = "";

            if (activeReminders.length > 0) {
              // Ordenar por fecha más próxima
              activeReminders.sort(
                (a, b) => new Date(a.scheduledTime) - new Date(b.scheduledTime)
              );

              activeReminders.slice(0, 3).forEach((reminder) => {
                const reminderDiv = document.createElement("div");
                reminderDiv.className =
                  "bg-gray-50 rounded-lg p-3 border border-gray-200";

                const timeUntil = new Date(reminder.scheduledTime) - new Date();
                const hoursUntil = Math.ceil(timeUntil / (1000 * 60 * 60));

                let typeIcon = "";
                let typeColor = "";

                if (reminder.type.includes("client")) {
                  typeIcon = "fas fa-user";
                  typeColor = "text-blue-600";
                } else if (reminder.type.includes("therapist")) {
                  typeIcon = "fas fa-user-md";
                  typeColor = "text-green-600";
                }

                reminderDiv.innerHTML = `
                <div class="flex items-center space-x-3">
                  <div class="w-6 h-6 ${typeColor} flex items-center justify-center">
                    <i class="${typeIcon} text-sm"></i>
                  </div>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-gray-800">
                      ${
                        reminder.type === "client24h"
                          ? "Cliente 24h"
                          : reminder.type === "client2h"
                          ? "Cliente 2h"
                          : reminder.type === "therapist30min"
                          ? "Terapeuta 30min"
                          : reminder.type
                      }
                    </div>
                    <div class="text-xs text-gray-600">
                      ${reminder.reservation.clientName} • ${
                  hoursUntil > 0 ? hoursUntil + "h" : "Próximamente"
                }
                    </div>
                  </div>
                  <div class="text-xs text-gray-500">
                    ${new Date(reminder.scheduledTime).toLocaleTimeString(
                      "es-AR",
                      { hour: "2-digit", minute: "2-digit" }
                    )}
                  </div>
                </div>
              `;

                upcomingContainer.appendChild(reminderDiv);
              });
            }
          } else {
            upcomingContainer.innerHTML = `
              <div class="text-center py-4 text-gray-500">
                <i class="fas fa-calendar-check text-2xl mb-2"></i>
                <p class="text-sm">No hay recordatorios programados</p>
              </div>
            `;
          }

          // Actualizar estado del sistema
          const statusDiv = document.getElementById("reminder-status");
          if (window.reminderSystem.isActive) {
            statusDiv.innerHTML = `
              <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
              <span class="text-xs text-gray-600">Activo</span>
            `;
          } else {
            statusDiv.innerHTML = `
              <div class="w-2 h-2 bg-red-500 rounded-full"></div>
              <span class="text-xs text-gray-600">Inactivo</span>
            `;
          }
        }
      };

      // Inicializar cuando se cargue la página
      document.addEventListener("DOMContentLoaded", function () {
        // Esperar a que el sistema de recordatorios se cargue
        setTimeout(() => {
          window.refreshReminderStats();

          // Actualizar estadísticas cada 30 segundos
          setInterval(window.refreshReminderStats, 30000);
        }, 1000);
      });

      // Funciones de mantenimiento para logs
      window.clearTestLogs = function () {
        if (window.reminderSystem) {
          const result = window.reminderSystem.clearTestLogs();
          alert(
            `✅ Logs de prueba eliminados\n\n- Mantenidos: ${result.kept}\n- Eliminados: ${result.removed}`
          );
          window.refreshReminderStats();
        } else {
          alert("❌ Sistema de recordatorios no disponible");
        }
      };

      window.showLogsSummary = function () {
        if (window.reminderSystem) {
          const summary = window.reminderSystem.getLogsSummary();
          console.log("📋 Resumen de logs mostrado en consola");
          alert(
            `📋 Resumen de Logs\n\n- Logs reales: ${summary.real}\n- Logs de prueba: ${summary.test}\n- Total: ${summary.total}\n\nVer consola para más detalles`
          );
        } else {
          alert("❌ Sistema de recordatorios no disponible");
        }
      };

      // Función para resetear completamente el sistema
      window.resetReminderSystem = function () {
        if (
          confirm(
            "🔄 ¿Resetear completamente el sistema de recordatorios?\n\nEsto eliminará TODOS los logs y datos guardados."
          )
        ) {
          localStorage.removeItem("reminderLogs");
          console.log("🔄 Sistema de recordatorios reseteado completamente");
          alert(
            "✅ Sistema reseteado. Los contadores ahora deberían mostrar 0."
          );
          window.refreshReminderStats();
        }
      };
    </script>

    <script>
      // Configuración de producción
      // Cambiar a true cuando suban el sitio al servidor
      window.PRODUCTION_MODE = false;
    </script>
    <script src="js/production-config.js"></script>
    <script src="cache-buster.js"></script>
    <script src="js/logger.js"></script>

    <script>
      // Función para manejar el login usando el nuevo sistema de autenticación
      async function handleTherapistLogin(event) {
        event.preventDefault();

        const email = document.getElementById("therapist-email").value;
        const password = document.getElementById("therapist-password").value;

        // Almacenar el texto original del botón
        const submitButton = event.target.querySelector(
          'button[type="submit"]'
        );
        const originalText = submitButton.innerHTML;

        try {
          // Cambiar el botón a estado de carga
          submitButton.innerHTML =
            '<i class="fas fa-spinner fa-spin mr-2"></i>Iniciando sesión...';
          submitButton.disabled = true;

          // Intentar autenticación con el nuevo sistema
          if (window.therapistAuth) {
            await window.therapistAuth.signIn(email, password);
          } else {
            throw new Error("Sistema de autenticación no disponible");
          }
        } catch (error) {
          console.error("Error en login:", error);
          // Mostrar error en la interfaz
          const errorDiv = document.createElement("div");
          errorDiv.className =
            "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4";
          errorDiv.textContent = "Error al iniciar sesión: " + error.message;

          const form = document.getElementById("login-form");
          form.insertBefore(errorDiv, form.firstChild);

          // Remover el mensaje de error después de 5 segundos
          setTimeout(() => {
            if (errorDiv.parentNode) {
              errorDiv.parentNode.removeChild(errorDiv);
            }
          }, 5000);
        } finally {
          // Restaurar botón
          submitButton.innerHTML = originalText;
          submitButton.disabled = false;
        }
      }
    </script>

    <script src="js/firebase.js"></script>
    <script src="js/firebase-init.js"></script>
    <script src="js/therapist-auth.js"></script>
    <script src="js/alternative-whatsapp.js"></script>
    <script src="js/email-service.js"></script>
    <script src="js/reminder-system.js"></script>
    <script src="js/therapist-panel.js"></script>
  </body>
</html>
